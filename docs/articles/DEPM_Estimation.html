<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEPM Estimation • DEPM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="DEPM Estimation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DEPM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/DEPMWt_Estimation.html">DEPMWt Estimation</a>
    </li>
    <li>
      <a href="../articles/DEPM_Estimation.html">DEPM Estimation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jonathansmart/DEPM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>DEPM Estimation</h1>
                        <h4 class="author">Jonathan Smart</h4>
            
            <h4 class="date">2020-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jonathansmart/DEPM/blob/master/vignettes/DEPM_Estimation.Rmd"><code>vignettes/DEPM_Estimation.Rmd</code></a></small>
      <div class="hidden name"><code>DEPM_Estimation.Rmd</code></div>

    </div>

    
    
<p>Load the DEPM and tidyverse libraries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DEPM)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</code></pre></div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The traditional Daily Egg Production Method (DEPM) has been used to determine spawning stock biomass of fish populations for over 40 years. While this package is primarily designed to facilitate the use of revised approaches to DEPM, including (stage-based estimation of daily egg production (McGarvey et al. 2018) and female adult size-dependence of population numbers and batch fecundity (DEPMWt; McGarvey et al in review), many aspects of the approach (i.e. estimation of some key DEPM parameters) remain the same. Therefore, the traditional DEPM methods are also included in this package. Here, an example of the DEPM approach is given using South Australian snapper (<em>Pagrus auratus</em>).</p>
</div>
<div id="necessary-data" class="section level1">
<h1 class="hasAnchor">
<a href="#necessary-data" class="anchor"></a>Necessary data</h1>
<p>Five datasets are required to use the DEPM approach:</p>
<ul>
<li>Egg density data to estimate daily egg production (<span class="math inline">\(P_{0}\)</span>)</li>
<li>Adult sex ratios to estimate <em>R</em>
</li>
<li>Female spawning fractions to estimate <em>S</em>
</li>
<li>Female total weights to estimate mean adult female weight (<em>W</em>)</li>
<li>Female total weight and batch fecundities to estimate mean female fecundity (<em>F</em>)</li>
</ul>
<p>Spawning Area (<em>A</em>) is not calculated as part of this package but its estimates will be included as one of the final steps.</p>
</div>
<div id="depmwt-parameter-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#depmwt-parameter-estimation" class="anchor"></a>DEPMWt parameter estimation</h1>
<div id="daily-egg-production-p_0" class="section level2">
<h2 class="hasAnchor">
<a href="#daily-egg-production-p_0" class="anchor"></a>Daily egg production (<span class="math inline">\(P_{0}\)</span>)</h2>
<p>Daily egg production is estimated using a stage-based estimator (McGarvey et al. 2018) via the function <code><a href="../reference/Estimate_P0.html">Estimate_P0()</a></code> which requires a dataset that has been formatted as such:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># egg density structure</span>
<span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(egg_data)
<span class="co">#&gt; 'data.frame':    2961 obs. of  6 variables:</span>
<span class="co">#&gt;  $ Region   : Factor w/ 4 levels "NGSV","NSG","SGSV",..: 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ Site     : Factor w/ 329 levels "GV18_005","GV18_006",..: 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">#&gt;  $ Stage_num: num  1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ Density  : num  0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">#&gt;  $ Age      : num  0.178 0.173 0.17 0.173 0.188 ...</span>
<span class="co">#&gt;  $ Hatch    : num  1.3 1.26 1.24 1.26 1.36 ...</span>

<span class="co"># egg density head()</span>
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(egg_data)
<span class="co">#&gt;   Region     Site Stage_num Density       Age    Hatch</span>
<span class="co">#&gt; 1   NGSV GV18_005         1       0 0.1782736 1.295414</span>
<span class="co">#&gt; 2   NGSV GV18_006         1       0 0.1730048 1.257129</span>
<span class="co">#&gt; 3   NGSV GV18_007         1       0 0.1701226 1.236185</span>
<span class="co">#&gt; 4   NGSV GV18_008         1       0 0.1727973 1.255621</span>
<span class="co">#&gt; 5   NGSV GV18_013         1       0 0.1877140 1.364012</span>
<span class="co">#&gt; 6   NGSV GV18_014         1       0 0.1839234 1.336468</span></code></pre></div>
<p>This dataset is in a long format where every row is a density estimate of the eggs in each stage of each sample. This dataset contains several columns that must include:</p>
<ul>
<li>Site - which represents each sample in the data (i.e. one plankton tow a location). It’s variable name must be specified as an argument using <code>site =</code>
</li>
<li>Density - the number of eggs in a single development stage in a metre cubed of seawater. The function will automatically determine the density column based on similar names (i.e. dens, density, DENSITY or other similar names). However, there cannot be multiple density columns.</li>
<li>Age - the age in days of each egg stage in each sample. The function will automatically determine the Age column based on similar names in a similar manner to the <code>Density</code> variable</li>
<li>Hatching time - The age in days where the eggs in each sample are estimated to hatch (usually differs based on temperature). The function will automatically determine the <code>Hatch</code> column based on similar names in a similar manner to the <code>Density</code> variable</li>
<li>Z - a pre-specified level of egg mortality used to determine <span class="math inline">\(P_{0}\)</span>. Multiple values can be provided to simultaneously determine different values of <span class="math inline">\(P_{0}\)</span> based on this parameter. Instruction on how to do this and how to perform sensitivity tests are provided in the final section of this vignette.</li>
</ul>
<p>Additional columns can be included in the dataset, so the user does not need to remove variables that could be useful to them later on. For example, in the <code>egg_data</code> dataset, the <code>Stage_num</code> variable represents the development stage of each density estimate in each sample. However as each row of this dataset is a different observation, this variable is not needed by the function.</p>
<p>The function also has the ability to break the data down spatially and temporally. If the <code>Region</code> and <code>Time</code> arguments are not used then <span class="math inline">\(P_{0}\)</span> will be estimated using all of the data. If you provide either <code>Region</code> or <code>Time</code> then a <span class="math inline">\(P_{0}\)</span> will be returned for each Region/Time combination. Therefore, a time series of data can analysed in a single function call. Here is an example using 4 DEPM surveys conducted in different areas but in the same year. The results are returned as a dataframe where each row is a survey and the estimate, standard error and specified mortality are returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># run P0 function</span>
P0_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_P0.html">Estimate_P0</a></span>(<span class="dt">data =</span> egg_data,
                          <span class="dt">site =</span> <span class="st">"Site"</span>, 
                          <span class="dt">Region =</span> <span class="st">"Region"</span>, 
                          <span class="dt">Z =</span> .<span class="dv">4</span>)

P0_results
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   Region    P0  P0_se     Z</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 NGSV   2.03  0.391    0.4</span>
<span class="co">#&gt; 2 NSG    0.947 0.218    0.4</span>
<span class="co">#&gt; 3 SGSV   0.527 0.129    0.4</span>
<span class="co">#&gt; 4 SSG    0.725 0.0849   0.4</span></code></pre></div>
</div>
<div id="spawning-fraction-s" class="section level2">
<h2 class="hasAnchor">
<a href="#spawning-fraction-s" class="anchor"></a>Spawning fraction (<em>S</em>)</h2>
<p>Spawning fraction is estimated using the function <code><a href="../reference/Estimate_Spawning_fraction.html">Estimate_Spawning_fraction()</a></code> which requires a dataset that has been formatted as two columns: 1) the number of females in spawning condition and 2)the total number of females. Each row represents a sample and the spawning fraction is estimated using a ratio estimator.</p>
<p>The correct columns in the dataset will be detected by the function. The column with the total number of females should be called “Total”, “Tot” or something similar. The column with the number of spawning females can include the term “spawn” or “yes” depending on how your dataset is setup. Ours is named “yes” as we had a “yes” or “no” designation for spawning fish.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(S_data)
<span class="co">#&gt; 'data.frame':    20 obs. of  3 variables:</span>
<span class="co">#&gt;  $ yes  : int  1 16 9 5 3 2 1 2 4 5 ...</span>
<span class="co">#&gt;  $ no   : int  6 2 1 4 2 1 2 4 2 1 ...</span>
<span class="co">#&gt;  $ Total: int  7 18 10 9 5 3 3 6 6 6 ...</span>

<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(S_data)
<span class="co">#&gt;   yes no Total</span>
<span class="co">#&gt; 1   1  6     7</span>
<span class="co">#&gt; 2  16  2    18</span>
<span class="co">#&gt; 3   9  1    10</span>
<span class="co">#&gt; 4   5  4     9</span>
<span class="co">#&gt; 5   3  2     5</span>
<span class="co">#&gt; 6   2  1     3</span></code></pre></div>
<p>Similar to other functions, specifying the <code>Region</code> or <code>Time</code> argument with relevant column names will group the estimates according to specific surveys. However, here an example is given without a region or time grouping. The results are returned as a dataframe with the estimate, its variance, the standard error and its CV. Each row represents a survey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Spawn_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_Spawning_fraction.html">Estimate_Spawning_fraction</a></span>(S_data)

Spawn_results
<span class="co">#&gt;   Ratio estimate    Variance         SE         CV</span>
<span class="co">#&gt; 1       0.722488 0.002977749 0.05456875 0.07552894</span></code></pre></div>
</div>
<div id="sex-ratio-r" class="section level2">
<h2 class="hasAnchor">
<a href="#sex-ratio-r" class="anchor"></a>Sex Ratio (R)</h2>
<p>Sex ratio is estimated using the function <code><a href="../reference/Estimate_sex_ratio.html">Estimate_sex_ratio()</a></code> which requires a dataset that has been formatted to include the weight of males and females along with <code>Region</code>/<code>Time</code> variables. Each row represents a sample and the sex ratio is estimated using a ratio estimator in the same manner as spawning fraction. The same Region/Time break down can be applied and Region is available in this dataset. The results returned are the same format as <code><a href="../reference/Estimate_Spawning_fraction.html">Estimate_Spawning_fraction()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(R_data)
<span class="co">#&gt;           Sample.code Year Region        F        M    Total</span>
<span class="co">#&gt; 1 ST12/1801B18-Dec-18 2018   NGSV  2.45000  6.42500  8.87500</span>
<span class="co">#&gt; 2 ZA12/1801B19-Dec-18 2018   NGSV 11.54800 10.83200 22.38000</span>
<span class="co">#&gt; 3 DC12/1801B11-Dec-18 2018    NSG  8.95600 16.22400 25.18000</span>
<span class="co">#&gt; 4 SA12/1801B12-Dec-18 2018    NSG  2.94000  7.18500 10.12500</span>
<span class="co">#&gt; 5     GLLOYD16-Dec-18 2018   SGSV 43.33143 51.11838 94.44980</span>
<span class="co">#&gt; 6     GLLOYD17-Dec-18 2018   SGSV 20.28760 16.20903 36.49663</span>

sex_ratio_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_sex_ratio.html">Estimate_sex_ratio</a></span>(R_data, <span class="dt">Region =</span> <span class="st">"Region"</span>)

sex_ratio_results
<span class="co">#&gt;   Region Ratio estimate     Variance         SE         CV</span>
<span class="co">#&gt; 1   NGSV      0.4478643 0.0095201654 0.09757133 0.21785913</span>
<span class="co">#&gt; 2    NSG      0.3369494 0.0007137716 0.02671650 0.07928936</span>
<span class="co">#&gt; 3   SGSV      0.3939694 0.0011661437 0.03414885 0.08667892</span>
<span class="co">#&gt; 4    SSG      0.5741385 0.0018484630 0.04299376 0.07488394</span></code></pre></div>
</div>
<div id="female-weight-and-fecundity" class="section level2">
<h2 class="hasAnchor">
<a href="#female-weight-and-fecundity" class="anchor"></a>Female weight and fecundity</h2>
<p>The key difference between teh DEPMWt approach and the traditional DEPM is how female weight and fecundity are handled. In the DEPMWt approach, female weight is broken into discrete weight bins and their variance is described using a multinomial distribution. However, in the traditional DEPM approach, the <em>W</em> parameter is used and represents the mean female weight and its variance. Similarly, fecundity is also expressed as the mean number of eggs per adult female and its variance.</p>
<p><strong>Fecundity</strong></p>
<p>Fecundity needs to be summarised in a couple of ways. Firstly, a batch-fecundity relationship is required for <strong>gonad free weight</strong> which can be used to predict the fecundity of fish whose histology has not been examined. This relationship can be estimated using the <code><a href="../reference/Estimate_Batch_Fecundity.html">Estimate_Batch_Fecundity()</a></code> function. This function is quite useful as it can return three sets of outputs:</p>
<ul>
<li>A data.frame of parameters and their variances for the relationship (these can also be printed to the screen) by setting <code>return.parameters = TRUE</code>.</li>
<li>A dataframe with the predicted fecundity for each weight along with SD and 95% confidence intervals</li>
<li>A dataframe with the predicted fecundity at specified weights and their variance.</li>
</ul>
<p>The batch fecundity estimator uses an allometric relationship which allows for wider variance with larger weights. Therefore, there are four parameters returned, alpha, beta and two sigma parameters that determine how variance changes with weight. A dataframe with two columns must be provided that includes <strong>gonad free weight in grams</strong> and the number of eggs for that fish. The function will determine which is which based on their scales (number of eggs &gt; Wt in grams). A set of starting parameters are required and are provided to the <code>start_pars</code> argument as a list. The estimated parameters are printed to the screen if <code>verbose = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(fecundity_data_GonardFrWT)
<span class="co">#&gt;   Gonad_fr_wt batch_fecund</span>
<span class="co">#&gt; 1        5450     394035.7</span>
<span class="co">#&gt; 2        6780     309483.9</span>
<span class="co">#&gt; 3        7490     494000.0</span>
<span class="co">#&gt; 4        5385     371710.5</span>
<span class="co">#&gt; 5        7525     626406.2</span>
<span class="co">#&gt; 6        8450     570789.5</span>

<span class="co"># List of starting parameters for the batch fecundity estimator</span>
parameters &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="dt">alpha=</span> <span class="dv">110</span>, <span class="dt">beta =</span> <span class="fl">0.85</span> , <span class="dt">Sigma0 =</span> <span class="fl">10.5</span>, <span class="dt">Sigma1 =</span> <span class="fl">0.7</span>)

<span class="co"># Return parameters</span>
Batch_fec_pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_Batch_Fecundity.html">Estimate_Batch_Fecundity</a></span>(fecundity_data_GonardFrWT, <span class="dt">start_pars =</span> parameters, <span class="dt">return.parameters =</span> <span class="ot">TRUE</span>)

<span class="co"># Return batch fecundity estimates</span>
Batch_fecundity_relationship &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_Batch_Fecundity.html">Estimate_Batch_Fecundity</a></span>(fecundity_data_GonardFrWT, <span class="dt">start_pars =</span> parameters, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)

<span class="co">#plot of relationship</span>
<span class="kw">ggplot</span>(Batch_fecundity_relationship, <span class="kw">aes</span>(Wt, <span class="dt">y =</span> Predicted, <span class="dt">ymin =</span> low, <span class="dt">ymax  =</span> upp))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>( <span class="dt">alpha =</span> .<span class="dv">3</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Fecundity), <span class="dt">alpha =</span> .<span class="dv">3</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Predicted), <span class="dt">col =</span> <span class="st">"royalblue"</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="DEPM_Estimation_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p><strong>Weight</strong> The parameters for <em>W</em> and <em>F</em> are determined using a single function called <code><a href="../reference/Estimate_mean_W_F.html">Estimate_mean_W_F()</a></code>. This function requires:</p>
<ul>
<li>A dataframe of <code>weight.data</code> which will be used to estimate <em>W</em> and estimate <em>F</em> based on the fecundity-at-weight relationship.</li>
<li>A character string for <code>TotalWt</code> indicating the variable name for Total weight in grams. This will be used to estimate <em>W</em>.</li>
<li>A character string for <code>GonadFrWt</code> indicating the variable name for gonad free weight in grams. This will be used to estimate <em>F</em> for each weight. If gonad free weight is not available, then this argument can be left <code>NULL</code> which will prompt the function to estimate fecundity based on total weight instead. <strong>NOTE: If total weight is used to determine <em>F</em> then total weight should be used in return batch fecundity parameters from <code><a href="../reference/Estimate_Batch_Fecundity.html">Estimate_Batch_Fecundity()</a></code> as well </strong>
</li>
<li>A dataframe of batch fecundity relationship parameters from <code><a href="../reference/Estimate_Batch_Fecundity.html">Estimate_Batch_Fecundity()</a></code> with <code>return.parameters = TRUE</code>. The object returned from this call can be directly provided to <code><a href="../reference/Estimate_mean_W_F.html">Estimate_mean_W_F()</a></code>.</li>
</ul>
<p>As with other functions, providng <code>Time</code>/<code>Region</code> variable names will group the results either spationally, temporally or both. Here a <code>Region</code> grouping is applied.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data structure</span>
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(Wt_data)
<span class="co">#&gt;   Year Region CFL Tot_WT..kgs. Tot_Wt..g. Sex Gonad.maturity Gonad.Wt Tot.Wt</span>
<span class="co">#&gt; 1 2018   NGSV 432        1.544       1544   F              3       70   1544</span>
<span class="co">#&gt; 2 2018   NGSV 485        2.374       2374   F              3      136   2374</span>
<span class="co">#&gt; 3 2018   NGSV 433        1.522       1522   F              3       42   1522</span>
<span class="co">#&gt; 4 2018   NGSV 435        1.592       1592   F              3       32   1592</span>
<span class="co">#&gt; 5 2018   NGSV 384        1.152       1152   F              3       18   1152</span>
<span class="co">#&gt; 6 2018   NGSV 411        1.410       1410   F              3       32   1410</span>
<span class="co">#&gt;   Gonad_free_Wt</span>
<span class="co">#&gt; 1          1474</span>
<span class="co">#&gt; 2          2238</span>
<span class="co">#&gt; 3          1480</span>
<span class="co">#&gt; 4          1560</span>
<span class="co">#&gt; 5          1134</span>
<span class="co">#&gt; 6          1378</span>

<span class="co"># Estimate mean W and mean F using total weight and gonad free weight, respectively.</span>
F_W_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_mean_W_F.html">Estimate_mean_W_F</a></span>(<span class="dt">weight.data =</span> Wt_data,
                              <span class="dt">TotalWt =</span> <span class="st">"Tot.Wt"</span>,
                              <span class="dt">GonadFrWt =</span> <span class="st">"Gonad_free_Wt"</span>,
                              <span class="dt">Region =</span> <span class="st">"Region"</span>,
                              <span class="dt">parameters =</span> Batch_fec_pars)
F_W_results
<span class="co">#&gt;   Region    Mean_W     var_W    Mean_F     var_F</span>
<span class="co">#&gt; 1   NGSV 1166.5000 31129.417  80851.28 232341876</span>
<span class="co">#&gt; 2    SSG  507.5385  2063.444  38843.33  68653911</span>
<span class="co">#&gt; 3    NSG  849.7143  8405.862  62139.22 130450028</span>
<span class="co">#&gt; 4   SGSV 2440.0174  9619.222 157896.28  60117239</span></code></pre></div>
</div>
<div id="spawning-area-a" class="section level2">
<h2 class="hasAnchor">
<a href="#spawning-area-a" class="anchor"></a>Spawning Area (<em>A</em>)</h2>
<p>Spawning area is the only DEPM parameter that is not estimated in this package as this is typically done using GIS methods. However, the Spawning area object can be created manually by taking another parameter object (<em>P0, S</em> or <em>R</em> are good choices) and using its <code>Time</code>/<code>Region</code> groupings to create new object. As this example has one survey from 4 regions in a single year, only the <code>Region</code> variable needs to be carried across. A new variable can then be added with the location in the correct order in that column. Spawning Area is a precise quantity and therefore does not require a variance. Note that spawning area must be in metres squared.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get Time/region combos from the P0 object</span>
Area &lt;-<span class="st"> </span><span class="kw">select</span>(P0_results, Region)

Area<span class="op">$</span>A &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2822201039</span>, <span class="co">#NGSV</span>
            <span class="dv">1884895030</span>, <span class="co"># NSG</span>
            <span class="dv">2285649237</span>, <span class="co"># SGSV</span>
            <span class="dv">3239913469</span>) <span class="co"># SSG</span>

<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(Area)
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   Region          A</span>
<span class="co">#&gt;   &lt;fct&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 NGSV   2822201039</span>
<span class="co">#&gt; 2 NSG    1884895030</span>
<span class="co">#&gt; 3 SGSV   2285649237</span>
<span class="co">#&gt; 4 SSG    3239913469</span></code></pre></div>
</div>
</div>
<div id="combining-parameters-as-inputs-for-biomass-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#combining-parameters-as-inputs-for-biomass-estimation" class="anchor"></a>Combining parameters as inputs for biomass estimation</h1>
<p>With all of the parameters now available to calculate spawning stock biomass, these now need to be combined into a dataset that can be input into the <code><a href="../reference/Estimate_DEPM_Biomass.html">Estimate_DEPM_Biomass()</a></code> function. For the DEPM approach, two objects are needed:</p>
<div id="combining-parameter-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-parameter-estimates" class="anchor"></a>Combining parameter estimates</h2>
<p>A dataframe of all of the parameter estimates can be assembled using <code><a href="../reference/combine_estimates.html">combine_estimates()</a></code> where each of the parameter objects are provided as arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Adults_pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/combine_estimates.html">combine_estimates</a></span>(<span class="dt">P0 =</span> P0_results, <span class="dt">R =</span> sex_ratio_results, <span class="dt">S =</span> Spawn_results, <span class="dt">A =</span> Area, <span class="dt">W_F =</span> F_W_results)
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span>
Adults_pars
<span class="co">#&gt; # A tibble: 4 x 8</span>
<span class="co">#&gt;   Region    P0     Z     R          A     S     W      .F</span>
<span class="co">#&gt;   &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 NGSV   2.03    0.4 0.448 2822201039 0.722 1166.  80851.</span>
<span class="co">#&gt; 2 NSG    0.947   0.4 0.337 1884895030 0.722  850.  62139.</span>
<span class="co">#&gt; 3 SGSV   0.527   0.4 0.394 2285649237 0.722 2440. 157896.</span>
<span class="co">#&gt; 4 SSG    0.725   0.4 0.574 3239913469 0.722  508.  38843.</span></code></pre></div>
<p>Where a parameter is estimated as time invariant, it will be automatically allocated to all of the <code>Region</code> or <code>Time</code> groupings applied for the other parameters. Here this occurs for <em>S</em>. However, if a particular parameter is missing in one instance but is not time invariant, it will not be carried over and <code>NA</code> will be returned. In this situation, it will need to be inserted manually. For example, lets pretend that <em>R</em> is missing for “SSG”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Adults_pars[Adults_pars<span class="op">$</span>Region <span class="op">==</span><span class="st"> "SSG"</span>, <span class="st">"R"</span>] &lt;-<span class="st"> </span><span class="fl">0.5741385</span></code></pre></div>
</div>
<div id="combining-parameter-variances" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-parameter-variances" class="anchor"></a>Combining parameter variances</h2>
<p>Variance estimates are needed by <code><a href="../reference/Estimate_DEPM_Biomass.html">Estimate_DEPM_Biomass()</a></code> in order to determine the precision of the biomass estimates. These are provided in the same fashion as the parameter estimates using <code><a href="../reference/combine_variances.html">combine_variances()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Adults_vars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/combine_variances.html">combine_variances</a></span>(P0_results, <span class="dt">R =</span> sex_ratio_results, <span class="dt">S =</span> Spawn_results, <span class="dt">W_F =</span> F_W_results)
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span>
Adults_vars
<span class="co">#&gt; # A tibble: 4 x 7</span>
<span class="co">#&gt;   Region     P0     Z        R       S      W         .F</span>
<span class="co">#&gt;   &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 NGSV   0.391    0.4 0.00952  0.00298 31129. 232341876.</span>
<span class="co">#&gt; 2 NSG    0.218    0.4 0.000714 0.00298  8406. 130450028.</span>
<span class="co">#&gt; 3 SGSV   0.129    0.4 0.00117  0.00298  9619.  60117239.</span>
<span class="co">#&gt; 4 SSG    0.0849   0.4 0.00185  0.00298  2063.  68653911.</span></code></pre></div>
<p>The same manual insertions can be performed on this object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Adults_vars[Adults_vars<span class="op">$</span>Region <span class="op">==</span><span class="st"> "SSG"</span>, <span class="st">"R"</span>] &lt;-<span class="st"> </span><span class="fl">0.0018484630</span></code></pre></div>
</div>
</div>
<div id="spawning-stock-biomass-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#spawning-stock-biomass-estimation" class="anchor"></a>Spawning Stock Biomass Estimation</h1>
<p>All of the hard work is done once all of the parameters and their variances have been estimated and organised. The final step is to combine them using <code><a href="../reference/Estimate_DEPM_Biomass.html">Estimate_DEPM_Biomass()</a></code>. This function requires each of these objects and will return a list of results which include the spawning stock biomass and total number of females.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Estimate Biomass</span>
Snapper_biomass_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_DEPM_Biomass.html">Estimate_DEPM_Biomass</a></span>(<span class="dt">adult.pars =</span> Adults_pars,
                                          <span class="dt">adult.vars =</span> Adults_vars)
<span class="co"># a list of two outputs is returned</span>
Snapper_biomass_results<span class="op">$</span>Biomass <span class="co"># biomass in kgs  </span>
<span class="co">#&gt;   Region   Z   Biomass        SD</span>
<span class="co">#&gt; 1   NGSV 0.4 255866.06 116146.57</span>
<span class="co">#&gt; 2    NSG 0.4 100289.13  54941.29</span>
<span class="co">#&gt; 3   SGSV 0.4  65373.58  45453.12</span>
<span class="co">#&gt; 4    SSG 0.4  74034.45  35203.11</span>
Snapper_biomass_results<span class="op">$</span>Nfem <span class="co"># number of females</span>
<span class="co">#&gt;   Region   Z     Nfem        SD</span>
<span class="co">#&gt; 1   NGSV 0.4 98236.85 36190.284</span>
<span class="co">#&gt; 2    NSG 0.4 39769.09 21125.869</span>
<span class="co">#&gt; 3   SGSV 0.4 10555.33  7269.314</span>
<span class="co">#&gt; 4    SSG 0.4 83749.38 38604.627</span></code></pre></div>
<p>The list of dataframes returned from the function can then be saved and used for plotting</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Create new objects</span>
Snapper_biomass &lt;-<span class="st"> </span>Snapper_biomass_results<span class="op">$</span>Biomass
Snapper_Nfem &lt;-<span class="st"> </span>Snapper_biomass_results<span class="op">$</span>Nfem</code></pre></div>
<p><strong>Plot biomass with SD</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(Snapper_biomass, <span class="kw">aes</span>(Region,Biomass, 
                            <span class="dt">ymin =</span> Biomass <span class="op">-</span><span class="st"> </span>SD,
                            <span class="dt">ymax =</span> Biomass <span class="op">+</span><span class="st"> </span>SD))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_crossbar</span>(<span class="dt">fill =</span> <span class="st">"royalblue"</span>, <span class="dt">alpha =</span> .<span class="dv">8</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">0</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">"Biomass (kg)"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>comma, <span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw"><a href="https://scales.r-lib.org//reference/pretty_breaks.html">pretty_breaks</a></span>(<span class="dv">5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="DEPM_Estimation_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p><strong>Plot total number of females</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(Snapper_Nfem, <span class="kw">aes</span>(Region,Nfem, 
                            <span class="dt">ymin =</span> Nfem <span class="op">-</span><span class="st"> </span>SD,
                            <span class="dt">ymax =</span> Nfem <span class="op">+</span><span class="st"> </span>SD))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_crossbar</span>(<span class="dt">fill =</span> <span class="st">"purple"</span>, <span class="dt">alpha =</span> .<span class="dv">8</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">0</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">"Number of females"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>comma, <span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw"><a href="https://scales.r-lib.org//reference/pretty_breaks.html">pretty_breaks</a></span>(<span class="dv">5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="DEPM_Estimation_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
</div>
<div id="testing-assumptions-for-pre-specified-egg-mortality-z" class="section level1">
<h1 class="hasAnchor">
<a href="#testing-assumptions-for-pre-specified-egg-mortality-z" class="anchor"></a>Testing assumptions for pre-specified egg mortality (<em>Z</em>)</h1>
<p>As the <span class="math inline">\(P_{0}\)</span> estimation methods in this package require a specified level of egg mortality (<em>Z</em>), it is sensible to test the sensitivities of the <span class="math inline">\(P_{0}\)</span> estimates, as well as the DEPMWt results to different <em>Z</em> values. Testing different values of <em>Z</em> can be done by passing a vector of values to the <code>z</code> argument of <code><a href="../reference/Estimate_P0.html">Estimate_P0()</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Multi_Z_P0_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_P0.html">Estimate_P0</a></span>(<span class="dt">data =</span> egg_data,
                          <span class="dt">site =</span> <span class="st">"Site"</span>, 
                          <span class="dt">Region =</span> <span class="st">"Region"</span>, 
                          <span class="dt">Z =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">2</span>, .<span class="dv">4</span>, .<span class="dv">6</span>))</code></pre></div>
<p>This will return a different <span class="math inline">\(P_{0}\)</span> estimate for each value of <em>Z</em> for each <code>Time</code>/<code>Region</code> grouping:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Multi_Z_P0_results
<span class="co">#&gt;    Region        P0      P0_se   Z</span>
<span class="co">#&gt; 1    NGSV 1.7972317 0.35215150 0.2</span>
<span class="co">#&gt; 2     NSG 0.8400430 0.19454626 0.2</span>
<span class="co">#&gt; 3    SGSV 0.4600852 0.11248190 0.2</span>
<span class="co">#&gt; 4     SSG 0.6294788 0.07419926 0.2</span>
<span class="co">#&gt; 5    NGSV 2.0333120 0.39057148 0.4</span>
<span class="co">#&gt; 6     NSG 0.9472290 0.21775974 0.4</span>
<span class="co">#&gt; 7    SGSV 0.5268231 0.12938292 0.4</span>
<span class="co">#&gt; 8     SSG 0.7254297 0.08486910 0.4</span>
<span class="co">#&gt; 9    NGSV 2.3084189 0.43464390 0.6</span>
<span class="co">#&gt; 10    NSG 1.0709549 0.24423117 0.6</span>
<span class="co">#&gt; 11   SGSV 0.6061931 0.15043110 0.6</span>
<span class="co">#&gt; 12    SSG 0.8390163 0.09755602 0.6</span></code></pre></div>
<p>For South Australian Snapper, the resulting <span class="math inline">\(P_{0}\)</span> estimates are very similar.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
Multi_Z_P0_results<span class="op">$</span>Z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(Multi_Z_P0_results<span class="op">$</span>Z) <span class="co"># convert Z to a factor for easy plotting</span>

<span class="kw">ggplot</span>(Multi_Z_P0_results, <span class="kw">aes</span>(Z, P0, <span class="dt">ymin =</span> P0 <span class="op">-</span><span class="st"> </span>P0_se, <span class="dt">ymax =</span> P0 <span class="op">+</span><span class="st"> </span>P0_se, <span class="dt">fill =</span> Z))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_crossbar</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Region, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">scales =</span> <span class="st">"free"</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="DEPM_Estimation_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>An object from <code><a href="../reference/Estimate_P0.html">Estimate_P0()</a></code> with multiple <em>Z</em>s can be included in the biomass estimation procedure in the same manner as before. When multiple <em>Z</em>s are provided to <code><a href="../reference/combine_estimates.html">combine_estimates()</a></code> and <code><a href="../reference/combine_variances.html">combine_variances()</a></code> they are treated as groupings and all other parameters will be aligned with them. When creating an object for spawning area <em>A</em>, care must be taken to only have unique <code>Time</code>/<code>Region</code> groupings. Using an object from <code><a href="../reference/Estimate_P0.html">Estimate_P0()</a></code> with multiple <em>Z</em>s can erroneously add duplicates if you’re not careful. This will cause error messages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make sure that Area has unique Time/Region breakdowns (Only Region used in this example)</span>
Area &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">Region =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(Multi_Z_P0_results<span class="op">$</span>Region))

Area<span class="op">$</span>A &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2822201039</span>, <span class="co">#NGSV</span>
            <span class="dv">1884895030</span>, <span class="co"># NSG</span>
            <span class="dv">2285649237</span>, <span class="co"># SGSV</span>
            <span class="dv">3239913469</span>) <span class="co"># SSG</span>


Multi_Z_adult_pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/combine_estimates.html">combine_estimates</a></span>(<span class="dt">P0 =</span> Multi_Z_P0_results, <span class="dt">R =</span> sex_ratio_results, <span class="dt">S =</span> Spawn_results, <span class="dt">A =</span> Area, <span class="dt">W_F =</span> F_W_results)
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span>

Multi_Z_adult_vars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/combine_variances.html">combine_variances</a></span>(<span class="dt">P0 =</span> Multi_Z_P0_results, <span class="dt">R =</span> sex_ratio_results, <span class="dt">S =</span> Spawn_results, <span class="dt">W_F =</span> F_W_results)
<span class="co">#&gt; Joining, by = "Region"</span>
<span class="co">#&gt; Joining, by = "Region"</span></code></pre></div>
<p>A new object with <em>Z</em> as a grouping will now be produced which can be passed to the biomass estimation function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Multi_Z_adult_pars
<span class="co">#&gt;    Region        P0   Z         R          A        S         W        .F</span>
<span class="co">#&gt; 1    NGSV 1.7972317 0.2 0.4478643 2822201039 0.722488 1166.5000  80851.28</span>
<span class="co">#&gt; 2     NSG 0.8400430 0.2 0.3369494 1884895030 0.722488  849.7143  62139.22</span>
<span class="co">#&gt; 3    SGSV 0.4600852 0.2 0.3939694 2285649237 0.722488 2440.0174 157896.28</span>
<span class="co">#&gt; 4     SSG 0.6294788 0.2 0.5741385 3239913469 0.722488  507.5385  38843.33</span>
<span class="co">#&gt; 5    NGSV 2.0333120 0.4 0.4478643 2822201039 0.722488 1166.5000  80851.28</span>
<span class="co">#&gt; 6     NSG 0.9472290 0.4 0.3369494 1884895030 0.722488  849.7143  62139.22</span>
<span class="co">#&gt; 7    SGSV 0.5268231 0.4 0.3939694 2285649237 0.722488 2440.0174 157896.28</span>
<span class="co">#&gt; 8     SSG 0.7254297 0.4 0.5741385 3239913469 0.722488  507.5385  38843.33</span>
<span class="co">#&gt; 9    NGSV 2.3084189 0.6 0.4478643 2822201039 0.722488 1166.5000  80851.28</span>
<span class="co">#&gt; 10    NSG 1.0709549 0.6 0.3369494 1884895030 0.722488  849.7143  62139.22</span>
<span class="co">#&gt; 11   SGSV 0.6061931 0.6 0.3939694 2285649237 0.722488 2440.0174 157896.28</span>
<span class="co">#&gt; 12    SSG 0.8390163 0.6 0.5741385 3239913469 0.722488  507.5385  38843.33</span>

<span class="co"># Estimate Biomass</span>
Snapper_biomass_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Estimate_DEPM_Biomass.html">Estimate_DEPM_Biomass</a></span>(<span class="dt">adult.pars =</span> Multi_Z_adult_pars,
                                          <span class="dt">adult.vars =</span> Multi_Z_adult_vars)


<span class="co"># Create new objects</span>
Snapper_biomass &lt;-<span class="st"> </span>Snapper_biomass_results<span class="op">$</span>Biomass
Snapper_Nfem &lt;-<span class="st"> </span>Snapper_biomass_results<span class="op">$</span>Nfem</code></pre></div>
<p>These results can then be examined to determine how biomass is influenced by the specification of <em>Z</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

Snapper_biomass<span class="op">$</span>Z &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(Snapper_biomass<span class="op">$</span>Z) <span class="co"># convert Z to a factor for easy plotting</span>

<span class="kw">ggplot</span>(Snapper_biomass, <span class="kw">aes</span>(Z,Biomass, <span class="dt">fill =</span> Z,
                            <span class="dt">ymin =</span> Biomass <span class="op">-</span><span class="st"> </span>SD,
                            <span class="dt">ymax =</span> Biomass <span class="op">+</span><span class="st"> </span>SD))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_crossbar</span>( <span class="dt">alpha =</span> .<span class="dv">8</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Region, <span class="dt">ncol =</span><span class="dv">2</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y =</span> <span class="dv">0</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">"Biomass (kg)"</span>, <span class="dt">labels =</span> scales<span class="op">::</span>comma, <span class="dt">breaks =</span> scales<span class="op">::</span><span class="kw"><a href="https://scales.r-lib.org//reference/pretty_breaks.html">pretty_breaks</a></span>(<span class="dv">5</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="DEPM_Estimation_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>McGarvey, R., Steer, M. A., Smart, J. J., Matthews, D. J. and Matthews, J. M.(in review). Generalizing the Parker model equation of DEPM: incorporating size dependence of population numbers and batch fecundity</p>
<p>McGarvey, R., Steer, M.A., Matthews, J.M., Ward, T.M. (2018). A stage-based estimator of daily egg production. ICES J. Mar. Sci. 75(5), 1638-1646.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#necessary-data">Necessary data</a></li>
      <li>
<a href="#depmwt-parameter-estimation">DEPMWt parameter estimation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#daily-egg-production-p_0">Daily egg production (<span class="math inline">\(P_{0}\)</span>)</a></li>
      <li><a href="#spawning-fraction-s">Spawning fraction (<em>S</em>)</a></li>
      <li><a href="#sex-ratio-r">Sex Ratio (R)</a></li>
      <li><a href="#female-weight-and-fecundity">Female weight and fecundity</a></li>
      <li><a href="#spawning-area-a">Spawning Area (<em>A</em>)</a></li>
      </ul>
</li>
      <li>
<a href="#combining-parameters-as-inputs-for-biomass-estimation">Combining parameters as inputs for biomass estimation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#combining-parameter-estimates">Combining parameter estimates</a></li>
      <li><a href="#combining-parameter-variances">Combining parameter variances</a></li>
      </ul>
</li>
      <li><a href="#spawning-stock-biomass-estimation">Spawning Stock Biomass Estimation</a></li>
      <li><a href="#testing-assumptions-for-pre-specified-egg-mortality-z">Testing assumptions for pre-specified egg mortality (<em>Z</em>)</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Smart, Richard McGarvey, Janet Matthews.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
